#!/usr/bin/env bash
# shellcheck disable=SC2155

set -Eeuo pipefail

release_path_old="github.com/golang/protobuf/protoc-gen-go"
release_path_new="github.com/protocolbuffers/protobuf-go/protoc-gen-go"

first_version_new_repo="1.20.0"

install() {
  local version=$2
  release_path=$release_path_old
  lowest=$(printf '%s\n' "$first_version_new_repo" "$version" | sort -V | head -n 1)
  if [[ "$lowest" == "$first_version_new_repo" ]]; then
    release_path=$release_path_new
  fi
  local install_path=$3
  local bin_install_path="$install_path/bin"

  echo "Creating bin directory"
  mkdir -p "${bin_install_path}"

  GO_BIN=$bin_install_path go install "${release_path}@${version}"
}

install "$ASDF_INSTALL_TYPE" "$ASDF_INSTALL_VERSION" "$ASDF_INSTALL_PATH"
